---
title: "Kuramoto Bifurcation Diagram"
subtitle: "Order Parameter vs Coupling"
format: html
---

The order parameter $r$ measures the coherence of the population. As coupling $K$ increases, the system transitions from incoherent ($r \approx 0$) to synchronized ($r > 0$).

For a Cauchy distribution with scale $\gamma$:

$$K_c = \frac{2}{\pi g(0)}, \qquad g(\omega)=\frac{1}{\pi} \frac{\gamma}{\omega^2+\gamma^2}.$$

The theoretical curve is

$$
\quad r=0 \text{ if } K \le K_c, \qquad r=\sqrt{1-\frac{K_c}{K}} \text{ if } K>K_c.
$$

```{python}
#| label: fig-kuramoto-bifurcation
#| fig-cap: 'Kuramoto diagram: theoretical curve and empirical points (smaller N for speed).'
#| fig-width: 7
#| fig-height: 4
#| echo: false

import numpy as np
import matplotlib.pyplot as plt
from scipy.integrate import solve_ivp

from code.odes_coupled.kuramoto import (
    initialize_oscillators,
    kuramoto_ode_meanfield,
    kuramoto_order_parameter,
)
from code.odes_coupled.kuramoto_diagram import kuramoto_critical_coupling

num_oscillators = 300
scale = 1.0
kmin, kmax, knum = 0.0, 5.0, 15
ls_k = np.linspace(kmin, kmax, knum)

r_theory = kuramoto_critical_coupling(ls_k, scale=scale, distribution="cauchy")

theta, omega = initialize_oscillators(num_oscillators, distribution="cauchy", scale_omega=scale, seed=1)

ls_r = np.zeros_like(ls_k)
for idx, k in enumerate(ls_k):
    sol = solve_ivp(kuramoto_ode_meanfield, (0, 30), theta, t_eval=np.linspace(0, 30, 200), args=(omega, k))
    theta = np.mod(sol.y, 2 * np.pi)
    r, _, _, _ = kuramoto_order_parameter(theta)
    ls_r[idx] = np.median(r[-20:])
    theta = theta[:, -1]

fig, ax = plt.subplots(figsize=(7, 4))
ax.plot(ls_k, r_theory, label="Theoretical", color="blue")
ax.plot(ls_k, ls_r, "o", label="Empirical", color="red")
ax.set_xlabel("Coupling strength (K)")
ax.set_ylabel("Order parameter (r)")
ax.set_title("Kuramoto Bifurcation Diagram")
ax.legend()
plt.show()
plt.close()
```

## Empirical vs theoretical

In the figure above we used a Cauchy distribution so the theoretical formula applies. If you use a normal distribution, the exact curve no longer matches. That is why the empirical points can look off if you mix formulas and distributions.

## Exercise

Reproduce the bifurcation diagram for $0 < K < 5$ using $N=1000$, $dt=0.01$, $t=100$, and average $r$ over the last ten steps.

Need a template? Start from [code/odes_coupled/kuramoto_diagram_template.py](../../code/odes_coupled/kuramoto_diagram_template.py).
